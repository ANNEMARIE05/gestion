<div class="animate-fade-in">
  <!-- Header -->
  <div class="mb-8">
    <div class="flex items-center justify-between">
      <div>
        <h1 class="text-3xl font-bold text-gray-900">Modifier le Projet R&D</h1>
        <p class="mt-2 text-sm text-gray-600">Modifier les informations du projet {{ project.numeroProjet }}</p>
      </div>
      <button routerLink="/production" class="bg-gray-100 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-200 transition-colors duration-200 flex items-center">
        <i class="fas fa-arrow-left mr-2"></i>Retour
      </button>
    </div>
  </div>

  <!-- Form -->
  <div class="card-shadow bg-white rounded-none p-8">
    <form (ngSubmit)="onSubmit()" #projectForm="ngForm">
      <div class="grid grid-cols-1 gap-6 lg:grid-cols-2">
        <!-- N° Projet -->
        <div>
          <label for="numeroProjet" class="block text-sm font-medium text-gray-700 mb-2">
            N° Projet
          </label>
          <input 
            type="text" 
            id="numeroProjet" 
            name="numeroProjet"
            [(ngModel)]="project.numeroProjet"
            readonly
            class="w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50 text-gray-600 cursor-not-allowed"
            placeholder="Numéro du projet">
        </div>

        <!-- Application -->
        <div>
          <label for="application" class="block text-sm font-medium text-gray-700 mb-2">
            Projet / Application <span class="text-red-500">*</span>
          </label>
          <select 
            id="application" 
            name="application"
            [(ngModel)]="project.application"
            required
            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
            <option value="">Sélectionner une application</option>
            <option *ngFor="let app of applications" [value]="app">{{ app }}</option>
          </select>
        </div>

        <!-- Service DTI concerné -->
        <div>
          <label for="serviceDTI" class="block text-sm font-medium text-gray-700 mb-2">
            Service DTI concerné <span class="text-red-500">*</span>
          </label>
          <select 
            id="serviceDTI" 
            name="serviceDTI"
            [(ngModel)]="project.serviceDTI"
            required
            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
            <option value="">Sélectionner un service</option>
            <option *ngFor="let service of servicesDTI" [value]="service">{{ service }}</option>
          </select>
        </div>

        <!-- Responsable -->
        <div>
          <label for="responsable" class="block text-sm font-medium text-gray-700 mb-2">
            Responsable <span class="text-red-500">*</span>
          </label>
          <select 
            id="responsable" 
            name="responsable"
            [(ngModel)]="project.responsable"
            required
            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
            <option value="">Sélectionner un responsable</option>
            <option *ngFor="let resp of responsables" [value]="resp">{{ resp }}</option>
          </select>
        </div>

        <!-- Type de production -->
        <div>
          <label for="typeProduction" class="block text-sm font-medium text-gray-700 mb-2">
            Type de production <span class="text-red-500">*</span>
          </label>
          <select 
            id="typeProduction" 
            name="typeProduction"
            [(ngModel)]="project.typeProduction"
            required
            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
            <option value="">Sélectionner un type</option>
            <option value="Application Web">Application Web</option>
            <option value="Application Mobile">Application Mobile</option>
            <option value="Système Backend">Système Backend</option>
            <option value="Infrastructure">Infrastructure</option>
            <option value="Base de données">Base de données</option>
            <option value="API">API</option>
            <option value="Autre">Autre</option>
          </select>
        </div>

        <!-- Date de début -->
        <div>
          <label for="dateDebut" class="block text-sm font-medium text-gray-700 mb-2">
            Date de début <span class="text-red-500">*</span>
          </label>
          <input 
            type="date" 
            id="dateDebut" 
            name="dateDebut"
            [ngModel]="formatDateForInput(project.dateDebut)"
            (ngModelChange)="onDateChange($event, 'dateDebut')"
            required
            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
        </div>

        <!-- Date de fin prévue -->
        <div>
          <label for="dateFinPrevue" class="block text-sm font-medium text-gray-700 mb-2">
            Date de fin prévue <span class="text-red-500">*</span>
          </label>
          <input 
            type="date" 
            id="dateFinPrevue" 
            name="dateFinPrevue"
            [ngModel]="formatDateForInput(project.dateFinPrevue)"
            (ngModelChange)="onDateChange($event, 'dateFinPrevue')"
            required
            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
        </div>

        <!-- État d'avancement -->
        <div>
          <label for="etatAvancement" class="block text-sm font-medium text-gray-700 mb-2">
            État d'avancement (%) <span class="text-red-500">*</span>
          </label>
          <input 
            type="number" 
            id="etatAvancement" 
            name="etatAvancement"
            [(ngModel)]="project.etatAvancement"
            required
            min="0"
            max="100"
            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
            placeholder="0-100">
        </div>

        <!-- Statut -->
        <div>
          <label for="statut" class="block text-sm font-medium text-gray-700 mb-2">
            Statut <span class="text-red-500">*</span>
          </label>
          <select 
            id="statut" 
            name="statut"
            [(ngModel)]="project.statut"
            required
            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
            <option value="">Sélectionner un statut</option>
            <option value="En cours">En cours</option>
            <option value="OK">OK</option>
            <option value="NOK">NOK</option>
          </select>
        </div>

        <!-- Date de fin réelle -->
        <div>
          <label for="dateFinReelle" class="block text-sm font-medium text-gray-700 mb-2">
            Date de fin réelle
          </label>
          <input 
            type="date" 
            id="dateFinReelle" 
            name="dateFinReelle"
            [ngModel]="formatDateForInput(project.dateFinReelle)"
            (ngModelChange)="onDateChange($event, 'dateFinReelle')"
            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
        </div>
      </div>

      <!-- Champs en pleine largeur -->
      <div class="mt-6 space-y-6">
        <!-- Jalons clés atteints -->
        <div>
          <label for="jalonsCles" class="block text-sm font-medium text-gray-700 mb-2">
            Jalons clés atteints
          </label>
          <textarea 
            id="jalonsCles" 
            name="jalonsCles"
            [(ngModel)]="project.jalonsCles"
            rows="3"
            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
            placeholder="Décrivez les jalons clés atteints..."></textarea>
        </div>

        <!-- Problèmes rencontrés -->
        <div>
          <label for="problemesRencontres" class="block text-sm font-medium text-gray-700 mb-2">
            Problèmes rencontrés
          </label>
          <textarea 
            id="problemesRencontres" 
            name="problemesRencontres"
            [(ngModel)]="project.problemesRencontres"
            rows="3"
            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
            placeholder="Décrivez les problèmes rencontrés..."></textarea>
        </div>

        <!-- Actions correctives -->
        <div>
          <label for="actionsCorrectives" class="block text-sm font-medium text-gray-700 mb-2">
            Actions correctives
          </label>
          <textarea 
            id="actionsCorrectives" 
            name="actionsCorrectives"
            [(ngModel)]="project.actionsCorrectives"
            rows="3"
            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
            placeholder="Décrivez les actions correctives mises en place..."></textarea>
        </div>

        <!-- Commentaires -->
        <div>
          <label for="commentaires" class="block text-sm font-medium text-gray-700 mb-2">
            Commentaires
          </label>
          <textarea 
            id="commentaires" 
            name="commentaires"
            [(ngModel)]="project.commentaires"
            rows="3"
            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
            placeholder="Commentaires supplémentaires..."></textarea>
        </div>
      </div>

      <!-- Actions -->
      <div class="flex justify-end space-x-4 mt-8 pt-6 border-t border-gray-200">
        <button 
          type="button" 
          routerLink="/production" 
          class="bg-gray-100 text-gray-700 px-6 py-2 rounded-lg hover:bg-gray-200 transition-colors duration-200">
          Annuler
        </button>
        <button 
          type="submit" 
          [disabled]="!projectForm.form.valid || isLoading"
          class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200 flex items-center">
          <i *ngIf="isLoading" class="fas fa-spinner fa-spin mr-2"></i>
          <i *ngIf="!isLoading" class="fas fa-save mr-2"></i>
          {{ isLoading ? 'Modification...' : 'Modifier le projet' }}
        </button>
      </div>
    </form>
  </div>
</div>
